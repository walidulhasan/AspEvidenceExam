$('#registrationForm').steps({
    headerTag: 'h3',
    bodyTag: 'section',
    autoFocus: true,
    titleTemplate: '<span class="number">#index#</span> <span class="title">#title#</span>',
    onStepChanging: function (event, currentIndex, newIndex) {
        if (currentIndex < newIndex) {
            // Step 1 form validation
            if (currentIndex === 0) {



                // $('ul:nth-child(1)').css("float", "right");
                let name = $('#name').parsley();
                let gender = $('#gender').parsley();
                let fatherName = $('#father_name').parsley();
                let motherName = $('#mother_name').parsley();
                let email = $('#email').parsley();
                let mobile = $('#mobile_number').parsley();
                // let dob = $('#dob').parsley();
                let documentType = $('#document_type').parsley();
                let identificationNumber = $('#identification_number').parsley();
                let nid_upload = $('#nid_upload').parsley();
                let photo = $('#photo').parsley();
                let training_id = $('#training_id').parsley();

                let day = $('#day').val();
                let month = $('#month').val();
                let year = $('#year').val();



                if (training_id.isValid() && nid_upload.isValid() && name.isValid() && gender.isValid() && fatherName.isValid() && motherName.isValid() && email.isValid() && mobile.isValid() &&  documentType.isValid() && identificationNumber.isValid() && photo.isValid()) {
                    $('ul:nth-child(1)').css("float", "none");
                    return true;
                } else {
                    // $('ul:nth-child(1)').css("float", "none");
                    name.validate();
                    gender.validate();
                    fatherName.validate();
                    motherName.validate();
                    email.validate();
                    mobile.validate();
                    // dob.validate();
                    documentType.validate();
                    identificationNumber.validate();
                    photo.validate();
                    nid_upload.validate();
                    training_id.validate();
                }
                if(!day || !month || !year){
                    $('#dob-error').text('The date of birth is required.')
                    return false;
                }else{
                    $('#dob-error').text();
                }

                if (grecaptcha.getResponse()) {
                    alert('hi')
                } else {
                    // $(".captcha_error").show();
                    alert('error');
                }

            }
            if (currentIndex === 1) {
                $('ul:nth-child(1)').css("float", "none");
                let district = $('#district').parsley();
                let upazila = $('#upazila').parsley();
                let postOffice = $('#post_office').parsley();
                let address = $('#address').parsley();
                let division = $('#division').parsley();
                let trainingDivision = $('#training_district').parsley();


                if (district.isValid() && upazila.isValid() && postOffice.isValid() && address.isValid() && division.isValid() && trainingDivision.isValid()) {
                    return true;
                } else {
                    district.validate();
                    upazila.validate();
                    postOffice.validate();
                    address.validate();
                    division.validate();
                    trainingDivision.validate();
                }
            }
            // Always allow step back to the previous step even if the current step is not valid.
        } else {
            return true;
        }
    },

    onFinished: function (event, currentIndex) {
        if (currentIndex === 2) {
            let degree = $('#degree').parsley();
            let institute = $('#institute').parsley();
            let laptop = $('#laptop').parsley();
            if (degree.isValid() && institute.isValid() && laptop.isValid()) {
                $('.loading').show();
                $.ajaxSetup({headers: {"X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content")}}),
                    $.ajax({
                        url: '/registration',
                        type: "POST",
                        dataType: "JSON",
                        data: new FormData(document.getElementById("registrationForm")),
                        processData: !1,
                        contentType: !1,
                        success: function (e) {
                            $('.loading').hide();
                            if (e.success) {
                                $(".print-error-msg").css('display','none');
                                $('#registrationForm')[0].reset();
                                // $(".reg-success").show();
                                /*$('html, body').animate({
                                    scrollTop: $(".breadcrumbs").offset().top
                                }, 2000);*/
                                window.location.href = e.dashboard;

                                /*setTimeout(function () {
                                    location.reload();
                                }, 5000);*/
                            }
                        },
                        error: function (e, t, a) {
                            $('html, body').animate({
                                scrollTop: $(".breadcrumbs").offset().top
                            }, 2000);
                            printErrorMsg(e.responseJSON);
                            $('.loading').hide();
                            console.log(e)
                        }
                    })

                function printErrorMsg (error) {
                    $(".print-error-msg").find("ul").html('');
                    $(".print-error-msg").css('display','block');
                    $.each( error.errors, function( key, value ) {
                        $(".print-error-msg").find("ul").append('<li>'+value+'</li>');
                    });
                }
            } else {
                degree.validate();
                institute.validate();
                laptop.validate();
            }

        }

    }
});



